# MCP Playwright 仓库管理页面控件功能测试

## 🚨 统一错误处理策略

**任何MCP命令失败时，自动执行以下操作**：

### 标准错误处理流程：
1. **立即截图**
   ```javascript
   mcp__playwright__browser_take_screenshot({
     filename: './error/{失败步骤}_{时间戳}.png'
   })
   ```

2. **收集错误信息**
   ```javascript
   mcp__playwright__browser_console_messages()
   ```

3. **记录错误** (复制以下模板填写)
   ```
   ❌ 错误报告
   失败步骤：[哪一步失败了]
   错误现象：[看到什么页面/状态]
   错误信息：[MCP返回的具体错误文本]
   截图路径：[./error/文件名.png]
   时间：[发生时间]
   ```

---

## 前置条件

- 系统已有成功登录记录，可参考：`../00_warehouse_template.md`
- 登录凭据信息: 用户名 `adminstrator`，密码 `654321`，验证码 `1`
- 系统服务状态: 后端 `http://localhost:8088`，前端 `http://localhost:9528`
- 目标页面: `http://localhost:9528/#/master/warehouse`

## 测试步骤

### 第一阶段：确认基础模板测试已完成

**⚠️ 重要前置条件**: 
必须先完整执行 `./00_warehouse_template.md` 测试，确保：
- ✅ 登录成功
- ✅ 仓库管理页面正常加载  
- ✅ 所有基础功能验证通过

```javascript
// 1. 读取基础模板测试结果（仅供参考）
Read('./00_warehouse_template.md')
```
**说明**: 该文件应该已经执行完毕，此处仅读取了解测试内容

```javascript
// 2. 确认当前页面状态
mcp__playwright__browser_snapshot()
```
**预期**: 当前页面应该已经在 `http://localhost:9528/#/master/warehouse`，显示仓库管理页面

#### ❌ 错误检查：基础测试状态验证

如果发现以下任一情况，**立即停止测试**：

🚨 **停止条件检查**：
- **页面URL不正确** - 不是 `http://localhost:9528/#/master/warehouse`
- **页面标题错误** - 不包含"仓库管理"
- **页面内容异常** - 显示登录页、错误页、空白页
- **数据表格未加载** - 没有显示仓库数据列表
- **基础控件缺失** - 搜索框、操作按钮、分页控件不可见

```javascript
// 3. 控制台错误检查
mcp__playwright__browser_console_messages()
```

**🛑 如果控制台有以下严重错误，停止测试**：
- 认证失败错误
- API接口连接失败  
- 数据加载失败错误
- JavaScript运行时错误

**✅ 只有确认所有基础功能正常，才继续第二阶段测试**

---

### 第二阶段：开始详细控件测试

**📋 执行条件**: 第一阶段验证全部通过，无错误，页面状态正常

基于 `00_warehouse_template.md` 已完成的基础验证，现在开始逐个控件的详细功能测试。

---

## A. 搜索区域控件测试

### A1. 仓库名称输入框测试
```javascript
mcp__playwright__browser_type({
  element: '仓库名称输入框',
  ref: 'e1051',
  text: '测试仓库名称'
})
```
**预期**: 输入框能正常输入文字

```javascript
mcp__playwright__browser_snapshot()
```
**验证**: 输入框显示"测试仓库名称"

### A2. 仓库编码输入框测试
```javascript
mcp__playwright__browser_type({
  element: '仓库编码输入框',
  ref: 'e1055',
  text: 'WA20250910001'
})
```
**预期**: 编码输入框能正常输入

### A3. 仓库类型下拉框测试
```javascript
mcp__playwright__browser_click({
  element: '仓库类型下拉框',
  ref: 'e1062'
})
```
**预期**: 下拉框展开显示选项

```javascript
mcp__playwright__browser_wait_for({ time: 1 })
mcp__playwright__browser_snapshot()
```
**验证**: 下拉选项是否正常显示

```javascript
// 点击空白区域关闭下拉框
mcp__playwright__browser_click({
  element: '仓库名称输入框',
  ref: 'e1051'
})
```

### A4. 启用状态下拉框测试
```javascript
mcp__playwright__browser_click({
  element: '启用状态下拉框',
  ref: 'e1069'
})
```
**预期**: 状态下拉框展开

```javascript
mcp__playwright__browser_wait_for({ time: 1 })
mcp__playwright__browser_snapshot()
```
**验证**: 显示启用/禁用选项

```javascript
// 关闭下拉框
mcp__playwright__browser_click({
  element: '仓库名称输入框',
  ref: 'e1051'
})
```

### A5. 重置按钮测试
```javascript
mcp__playwright__browser_click({
  element: '重置按钮',
  ref: 'e1072'
})
```
**预期**: 清空所有搜索条件

```javascript
mcp__playwright__browser_snapshot()
```
**验证**: 输入框是否已清空

### A6. 查询按钮测试
```javascript
mcp__playwright__browser_click({
  element: '查询按钮',
  ref: 'e1075'
})
```
**预期**: 执行查询，表格数据刷新

```javascript
mcp__playwright__browser_wait_for({ time: 2 })
mcp__playwright__browser_snapshot()
```
**验证**: 查询是否正常执行

---

## B. 操作按钮区域测试

### B1. 新增按钮测试
```javascript
mcp__playwright__browser_click({
  element: '新增按钮',
  ref: 'e1078'
})
```
**预期**: 打开新增仓库对话框

```javascript
mcp__playwright__browser_wait_for({ time: 2 })
mcp__playwright__browser_snapshot()
```
**验证**: 新增对话框是否正常显示

```javascript
// 关闭对话框（通过按ESC键或点击关闭按钮）
mcp__playwright__browser_press_key({ key: 'Escape' })
```

### B2. 导出按钮测试
```javascript
mcp__playwright__browser_click({
  element: '导出按钮',
  ref: 'e1090'
})
```
**预期**: 开始导出数据

```javascript
mcp__playwright__browser_wait_for({ time: 2 })
mcp__playwright__browser_snapshot()
```
**验证**: 导出功能是否触发

### B3. 禁用按钮状态测试
```javascript
mcp__playwright__browser_snapshot()
```
**验证目标**: 确认以下按钮为禁用状态（灰色）
- 修改按钮 (ref: e1080)
- 删除按钮 (ref: e1082) 
- 查看按钮 (ref: e1084)
- 启用按钮 (ref: e1086)
- 停用按钮 (ref: e1088)

---

## C. 数据表格交互测试

### C1. 表格列标题点击测试（排序功能）
```javascript
mcp__playwright__browser_click({
  element: '仓库编码列标题',
  ref: 'e1123'
})
```
**预期**: 表格按仓库编码排序

```javascript
mcp__playwright__browser_wait_for({ time: 1 })
mcp__playwright__browser_snapshot()
```
**验证**: 数据是否重新排序

```javascript
mcp__playwright__browser_click({
  element: '仓库名称列标题',
  ref: 'e1128'
})
```
**预期**: 表格按仓库名称排序

### C2. 数据行选择测试
```javascript
mcp__playwright__browser_click({
  element: '第一行数据',
  ref: 'e1247'
})
```
**预期**: 选中第一行数据，操作按钮状态改变

```javascript
mcp__playwright__browser_snapshot()
```
**验证**: 
- 数据行是否高亮选中
- 修改、删除、查看等按钮是否变为可用状态

### C3. 选中状态下的按钮测试
```javascript
// 测试查看按钮（选中数据后应该可用）
mcp__playwright__browser_click({
  element: '查看按钮',
  ref: 'e1084'
})
```
**预期**: 打开查看详情对话框

```javascript
mcp__playwright__browser_wait_for({ time: 2 })
mcp__playwright__browser_snapshot()
```
**验证**: 查看对话框是否正常显示

```javascript
// 关闭对话框
mcp__playwright__browser_press_key({ key: 'Escape' })
```

---

## D. 分页控件测试

### D1. 每页条数下拉框测试
```javascript
mcp__playwright__browser_click({
  element: '每页条数下拉框',
  ref: 'e1937'
})
```
**预期**: 显示每页条数选项

```javascript
mcp__playwright__browser_wait_for({ time: 1 })
mcp__playwright__browser_snapshot()
```
**验证**: 下拉选项是否正常显示

```javascript
// 关闭下拉框
mcp__playwright__browser_press_key({ key: 'Escape' })
```

### D2. 下一页按钮测试
```javascript
mcp__playwright__browser_click({
  element: '下一页按钮',
  ref: 'e1948'
})
```
**预期**: 翻到第2页

```javascript
mcp__playwright__browser_wait_for({ time: 2 })
mcp__playwright__browser_snapshot()
```
**验证**: 页码是否变为2，数据是否刷新

### D3. 页码直接点击测试
```javascript
mcp__playwright__browser_click({
  element: '第3页按钮',
  ref: 'e1943'
})
```
**预期**: 跳转到第3页

```javascript
mcp__playwright__browser_wait_for({ time: 2 })
mcp__playwright__browser_snapshot()
```
**验证**: 页码和数据是否正确

### D4. 跳转功能测试
```javascript
mcp__playwright__browser_type({
  element: '跳转页码输入框',
  ref: 'e1952',
  text: '1'
})
```

```javascript
mcp__playwright__browser_press_key({ key: 'Enter' })
```
**预期**: 跳转回第1页

```javascript
mcp__playwright__browser_wait_for({ time: 2 })
mcp__playwright__browser_snapshot()
```
**验证**: 是否成功跳转到第1页

---

## E. 最终验证

### E1. 控制台错误检查
```javascript
mcp__playwright__browser_console_messages()
```
**预期**: 无严重错误信息

### E2. 最终页面状态截图
```javascript
mcp__playwright__browser_snapshot()
```
**验证**: 页面整体状态是否正常

---

## 📊 测试结果记录

**测试执行时间**: [填写]  
**执行人**: [填写]  

### ✅ 通过的控件
- [ ] A1. 仓库名称输入框
- [ ] A2. 仓库编码输入框  
- [ ] A3. 仓库类型下拉框
- [ ] A4. 启用状态下拉框
- [ ] A5. 重置按钮
- [ ] A6. 查询按钮
- [ ] B1. 新增按钮
- [ ] B2. 导出按钮
- [ ] B3. 禁用按钮状态
- [ ] C1. 表格排序功能
- [ ] C2. 数据行选择
- [ ] C3. 选中后按钮状态
- [ ] D1. 每页条数下拉框
- [ ] D2. 分页导航按钮
- [ ] D3. 页码直接点击
- [ ] D4. 页码跳转功能

### ❌ 发现的问题
[记录发现的问题和error目录中的截图文件名]

### 🎯 总体评估
**控件测试状态**: [成功/部分成功/失败]  
**关键功能**: [正常/异常]  
**建议**: [改进建议]

---

## 测试说明

本测试涵盖了仓库管理页面的所有主要控件：
1. **搜索区域** - 输入框、下拉框、按钮交互
2. **操作按钮** - 功能按钮和状态变化
3. **数据表格** - 排序、选择、交互功能
4. **分页控件** - 分页导航和跳转功能

每个控件都进行了**点击/输入 → 等待 → 截图验证**的完整测试流程，确保控件的显示和交互功能都正常工作。