/**
 * Element UI主题配置
 * @description 为JimuReport定制的Element UI主题配置
 * @author SCM Report Team
 */

/**
 * Element UI主题色彩配置
 */
export const elementTheme = {
  // 主要颜色
  '--el-color-primary': '#409EFF',
  '--el-color-primary-light-1': '#53a8ff',
  '--el-color-primary-light-2': '#66b1ff',
  '--el-color-primary-light-3': '#79bbff',
  '--el-color-primary-light-4': '#8cc5ff',
  '--el-color-primary-light-5': '#a0cfff',
  '--el-color-primary-light-6': '#b3d8ff',
  '--el-color-primary-light-7': '#c6e2ff',
  '--el-color-primary-light-8': '#d9ecff',
  '--el-color-primary-light-9': '#ecf5ff',
  '--el-color-primary-dark-2': '#337ecc',
  
  // 成功色
  '--el-color-success': '#67C23A',
  '--el-color-success-light-1': '#75cf47',
  '--el-color-success-light-2': '#82dd55',
  '--el-color-success-light-3': '#90ea62',
  '--el-color-success-light-4': '#9df770',
  '--el-color-success-light-5': '#abf47d',
  '--el-color-success-light-6': '#b8f18b',
  '--el-color-success-light-7': '#c5f598',
  '--el-color-success-light-8': '#d3f8a6',
  '--el-color-success-light-9': '#e0fcb3',
  '--el-color-success-dark-2': '#529b2e',
  
  // 警告色
  '--el-color-warning': '#E6A23C',
  '--el-color-warning-light-1': '#eab050',
  '--el-color-warning-light-2': '#eebe65',
  '--el-color-warning-light-3': '#f2cc79',
  '--el-color-warning-light-4': '#f5da8e',
  '--el-color-warning-light-5': '#f9e8a2',
  '--el-color-warning-light-6': '#fcf6b7',
  '--el-color-warning-light-7': '#fef4cb',
  '--el-color-warning-light-8': '#fff2e0',
  '--el-color-warning-light-9': '#fdf6ec',
  '--el-color-warning-dark-2': '#b88230',
  
  // 危险色
  '--el-color-danger': '#F56C6C',
  '--el-color-danger-light-1': '#f78989',
  '--el-color-danger-light-2': '#f9a0a0',
  '--el-color-danger-light-3': '#fab6b6',
  '--el-color-danger-light-4': '#fccdcd',
  '--el-color-danger-light-5': '#fde2e2',
  '--el-color-danger-light-6': '#fef0f0',
  '--el-color-danger-light-7': '#fff5f5',
  '--el-color-danger-light-8': '#fffafa',
  '--el-color-danger-light-9': '#fdf2f2',
  '--el-color-danger-dark-2': '#c45656',
  
  // 信息色
  '--el-color-info': '#909399',
  '--el-color-info-light-1': '#a6a9ad',
  '--el-color-info-light-2': '#bcbec2',
  '--el-color-info-light-3': '#d1d3d6',
  '--el-color-info-light-4': '#e7e9eb',
  '--el-color-info-light-5': '#f4f4f5',
  '--el-color-info-light-6': '#f9f9f9',
  '--el-color-info-light-7': '#fdfdfd',
  '--el-color-info-light-8': '#ffffff',
  '--el-color-info-light-9': '#ffffff',
  '--el-color-info-dark-2': '#73767a',
  
  // 文本颜色
  '--el-text-color-primary': '#303133',
  '--el-text-color-regular': '#606266',
  '--el-text-color-secondary': '#909399',
  '--el-text-color-placeholder': '#C0C4CC',
  '--el-text-color-disabled': '#C0C4CC',
  
  // 边框颜色
  '--el-border-color': '#DCDFE6',
  '--el-border-color-light': '#E4E7ED',
  '--el-border-color-lighter': '#EBEEF5',
  '--el-border-color-extra-light': '#F2F6FC',
  '--el-border-color-dark': '#D4D7DE',
  '--el-border-color-darker': '#CDD0D6',
  
  // 填充颜色
  '--el-fill-color': '#F0F2F5',
  '--el-fill-color-light': '#F5F7FA',
  '--el-fill-color-lighter': '#FAFAFA',
  '--el-fill-color-extra-light': '#FAFCFF',
  '--el-fill-color-dark': '#EBEDF0',
  '--el-fill-color-darker': '#E6E8EB',
  '--el-fill-color-blank': '#FFFFFF',
  
  // 背景颜色
  '--el-bg-color': '#FFFFFF',
  '--el-bg-color-page': '#F2F3F5',
  '--el-bg-color-overlay': '#FFFFFF',
  
  // 字体
  '--el-font-size-extra-large': '20px',
  '--el-font-size-large': '18px',
  '--el-font-size-medium': '16px',
  '--el-font-size-base': '14px',
  '--el-font-size-small': '13px',
  '--el-font-size-extra-small': '12px',
  
  // 字重
  '--el-font-weight-primary': '500',
  '--el-font-weight-secondary': '100',
  
  // 行高
  '--el-line-height-primary': '24px',
  '--el-line-height-secondary': '16px',
  
  // 边框
  '--el-border-width': '1px',
  '--el-border-style': 'solid',
  '--el-border-radius-base': '4px',
  '--el-border-radius-small': '2px',
  '--el-border-radius-round': '20px',
  '--el-border-radius-circle': '100%',
  
  // 盒子阴影
  '--el-box-shadow': '0 12px 32px 4px rgba(0, 0, 0, 0.04), 0 8px 20px rgba(0, 0, 0, 0.08)',
  '--el-box-shadow-light': '0 0 12px rgba(0, 0, 0, 0.12)',
  '--el-box-shadow-lighter': '0 0 6px rgba(0, 0, 0, 0.12)',
  '--el-box-shadow-dark': '0 16px 48px 16px rgba(0, 0, 0, 0.08), 0 12px 32px rgba(0, 0, 0, 0.12), 0 8px 16px -8px rgba(0, 0, 0, 0.16)',
  
  // 禁用状态
  '--el-disabled-bg-color': '#f5f7fa',
  '--el-disabled-text-color': '#c0c4cc',
  '--el-disabled-border-color': '#e4e7ed'
}

/**
 * 报表专用主题扩展
 */
export const reportThemeExtension = {
  // 报表设计器专用色彩
  '--report-designer-bg': '#f5f5f5',
  '--report-designer-panel-bg': '#ffffff',
  '--report-designer-toolbar-bg': '#fafafa',
  '--report-designer-canvas-bg': '#ffffff',
  '--report-designer-grid-color': '#f0f0f0',
  '--report-designer-selection-color': '#409EFF',
  '--report-designer-selection-bg': 'rgba(64, 158, 255, 0.1)',
  
  // 报表组件边框
  '--report-component-border': '#dcdfe6',
  '--report-component-border-hover': '#409EFF',
  '--report-component-border-selected': '#409EFF',
  '--report-component-border-width': '1px',
  
  // 报表状态色彩
  '--report-status-draft': '#909399',
  '--report-status-draft-bg': '#f4f4f5',
  '--report-status-published': '#67c23a',
  '--report-status-published-bg': '#f0f9ff',
  '--report-status-offline': '#e6a23c',
  '--report-status-offline-bg': '#fdf6ec',
  '--report-status-archived': '#f56c6c',
  '--report-status-archived-bg': '#fef0f0',
  
  // 报表类型色彩
  '--report-type-table': '#409EFF',
  '--report-type-table-bg': '#e6f7ff',
  '--report-type-chart': '#67c23a',
  '--report-type-chart-bg': '#f6ffed',
  '--report-type-complex': '#e6a23c',
  '--report-type-complex-bg': '#fff7e6',
  '--report-type-form': '#722ed1',
  '--report-type-form-bg': '#f9f0ff',
  
  // BI大屏专用色彩
  '--bi-screen-bg': '#0f1419',
  '--bi-screen-panel-bg': 'rgba(255, 255, 255, 0.05)',
  '--bi-screen-border': 'rgba(255, 255, 255, 0.1)',
  '--bi-screen-text': '#ffffff',
  '--bi-screen-text-secondary': 'rgba(255, 255, 255, 0.65)',
  
  // 图表配色方案
  '--chart-color-1': '#5B8FF9',
  '--chart-color-2': '#61DDAA',
  '--chart-color-3': '#65789B',
  '--chart-color-4': '#F6BD16',
  '--chart-color-5': '#7262fd',
  '--chart-color-6': '#78D3F8',
  '--chart-color-7': '#9661BC',
  '--chart-color-8': '#F6903D',
  '--chart-color-9': '#008685',
  '--chart-color-10': '#F08BB4'
}

/**
 * 组件尺寸配置
 */
export const componentSizes = {
  'large': {
    '--el-component-size-large': '40px',
    '--el-button-size-large': '40px',
    '--el-input-height-large': '40px',
    '--el-select-height-large': '40px'
  },
  'default': {
    '--el-component-size': '32px',
    '--el-button-size': '32px',
    '--el-input-height': '32px',
    '--el-select-height': '32px'
  },
  'small': {
    '--el-component-size-small': '24px',
    '--el-button-size-small': '24px',
    '--el-input-height-small': '24px',
    '--el-select-height-small': '24px'
  }
}

/**
 * 响应式断点配置
 */
export const breakpoints = {
  '--el-sm': '768px',
  '--el-md': '992px',
  '--el-lg': '1200px',
  '--el-xl': '1920px'
}

/**
 * 过渡动画配置
 */
export const transitions = {
  '--el-transition-duration': '0.3s',
  '--el-transition-duration-fast': '0.2s',
  '--el-transition-function-ease-in-out-bezier': 'cubic-bezier(0.645, 0.045, 0.355, 1)',
  '--el-transition-function-fast-bezier': 'cubic-bezier(0.23, 1, 0.32, 1)',
  '--el-transition-all': 'all var(--el-transition-duration) var(--el-transition-function-ease-in-out-bezier)',
  '--el-transition-fade': 'opacity var(--el-transition-duration) var(--el-transition-function-fast-bezier)',
  '--el-transition-md-fade': 'transform var(--el-transition-duration) var(--el-transition-function-fast-bezier), opacity var(--el-transition-duration) var(--el-transition-function-fast-bezier)',
  '--el-transition-fade-linear': 'opacity var(--el-transition-duration-fast) linear',
  '--el-transition-border': 'border-color var(--el-transition-duration-fast) var(--el-transition-function-ease-in-out-bezier)',
  '--el-transition-box-shadow': 'box-shadow var(--el-transition-duration-fast) var(--el-transition-function-ease-in-out-bezier)',
  '--el-transition-color': 'color var(--el-transition-duration-fast) var(--el-transition-function-ease-in-out-bezier)'
}

/**
 * 应用主题到DOM
 * @param {Object} theme - 主题配置对象
 */
export function applyTheme(theme = {}) {
  const root = document.documentElement
  const finalTheme = {
    ...elementTheme,
    ...reportThemeExtension,
    ...componentSizes.default,
    ...breakpoints,
    ...transitions,
    ...theme
  }
  
  Object.keys(finalTheme).forEach(key => {
    root.style.setProperty(key, finalTheme[key])
  })
}

/**
 * 获取当前主题变量值
 * @param {string} variable - CSS变量名
 * @returns {string} 变量值
 */
export function getThemeVariable(variable) {
  return getComputedStyle(document.documentElement).getPropertyValue(variable).trim()
}

/**
 * 动态切换主题
 * @param {string} themeName - 主题名称 ('light' | 'dark')
 */
export function switchTheme(themeName) {
  const themes = {
    light: {
      ...elementTheme,
      ...reportThemeExtension
    },
    dark: {
      // 暗黑主题配置
      '--el-bg-color': '#141414',
      '--el-bg-color-page': '#0a0a0a',
      '--el-bg-color-overlay': '#1d1e1f',
      '--el-text-color-primary': '#E5EAF3',
      '--el-text-color-regular': '#CFD3DC',
      '--el-text-color-secondary': '#A3A6AD',
      '--el-text-color-placeholder': '#8D9095',
      '--el-border-color': '#4C4D4F',
      '--el-border-color-light': '#414243',
      '--el-border-color-lighter': '#363637',
      '--el-border-color-extra-light': '#2B2B2C',
      '--el-fill-color': '#303133',
      '--el-fill-color-light': '#262727',
      '--el-fill-color-lighter': '#1D1D1F',
      '--el-fill-color-extra-light': '#191919',
      '--el-fill-color-dark': '#39393D',
      '--el-fill-color-darker': '#424243',
      '--el-fill-color-blank': '#141414',
      
      // 报表暗黑主题
      '--report-designer-bg': '#141414',
      '--report-designer-panel-bg': '#1d1e1f',
      '--report-designer-toolbar-bg': '#262727',
      '--report-designer-canvas-bg': '#1d1e1f',
      '--report-designer-grid-color': '#363637'
    }
  }
  
  applyTheme(themes[themeName] || themes.light)
}

/**
 * 初始化主题系统
 */
export function initTheme() {
  // 检查用户偏好
  const userPreference = localStorage.getItem('report-theme') || 'light'
  const systemPreference = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
  const theme = userPreference === 'auto' ? systemPreference : userPreference
  
  // 应用主题
  switchTheme(theme)
  
  // 监听系统主题变化
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
    if (localStorage.getItem('report-theme') === 'auto') {
      switchTheme(e.matches ? 'dark' : 'light')
    }
  })
}

/**
 * 保存用户主题偏好
 * @param {string} theme - 主题偏好 ('light' | 'dark' | 'auto')
 */
export function saveThemePreference(theme) {
  localStorage.setItem('report-theme', theme)
  if (theme !== 'auto') {
    switchTheme(theme)
  } else {
    const systemPreference = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
    switchTheme(systemPreference)
  }
}

/**
 * 获取用户主题偏好
 * @returns {string} 主题偏好
 */
export function getThemePreference() {
  return localStorage.getItem('report-theme') || 'light'
}